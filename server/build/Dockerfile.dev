FROM golang:1.24-alpine

WORKDIR /app

RUN go install github.com/air-verse/air@v1.62.0

COPY go.mod go.sum ./
RUN go mod download

RUN mkdir -p /etc/air
RUN cat <<-EOF > /etc/air/.air.toml
    tmp_dir = "/tmp/air"
    [build]
    cmd = "go build -o /tmp/air/main cmd/http/main.go"
    bin = "/tmp/air/main"
    delay = 600
    [log]
    silent = true
EOF

CMD ["air", "-c", "/etc/air/.air.toml"]
